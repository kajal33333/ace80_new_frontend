Perfect! Let me create **ONLY the Farmer's flow** (Flutter mobile app side). Clean and focused.

***

# ğŸ‘¨â€ğŸŒ¾ Farmer Chat Flow (Flutter Mobile App Only)

---

## ğŸ” FLOW 1: Farmer Opens Support

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: FARMER OPENS SUPPORT IN FLUTTER APP                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Farmer Opens App â†’ Taps "Contact Support" ğŸ“
    â”‚
    â”‚ Navigate to ChatScreen()
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ChatScreen initState() Triggers                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Show loading indicator
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚       â”‚        â”‚                  â”‚
         â–¼       â–¼        â–¼                  â–¼
    [API 1]  [API 2]  [SOCKET]         [API 3]


API 1: CREATE/GET CONVERSATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â”‚ POST http://localhost:5000/api/v1/chat/conversations
    â”‚ Headers: { "Authorization": "Bearer YOUR_TOKEN" }
    â–¼
    Returns: {
      _id: "conv123",
      assignedSupportId: { first_name: "Support", last_name: "Agent" },
      status: "open"
    }
    â”‚
    â–¼
    Store: conversationId = "conv123"


API 2: GET CONVERSATIONS LIST (Optional)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â”‚ GET http://localhost:5000/api/v1/chat/conversations
    â”‚ Headers: { "Authorization": "Bearer YOUR_TOKEN" }
    â–¼
    Returns: { data: [{ conversation1, conversation2... }] }


SOCKET: CONNECT TO SERVER
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â”‚ socket = IO.io('http://localhost:5000', {
    â”‚   'transports': ['websocket'],
    â”‚   'auth': {'token': YOUR_TOKEN}
    â”‚ });
    â”‚ socket.connect();
    â–¼
    Server authenticates and sets farmer online
    â”‚
    â–¼
    socket.onConnect((data) {
      print('Connected to server');
    })


API 3: LOAD MESSAGE HISTORY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â”‚ GET http://localhost:5000/api/v1/chat/messages/conv123
    â”‚ Query: ?page=1&limit=50
    â”‚ Headers: { "Authorization": "Bearer YOUR_TOKEN" }
    â–¼
    Returns: {
      data: [
        { _id: "msg1", senderId: {...}, content: "Hello", isRead: true },
        { _id: "msg2", ... }
      ],
      pagination: { currentPage: 1, totalPages: 2 }
    }
    â”‚
    â–¼
    setState(() { messages = response['data']; })


AFTER ALL COMPLETE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â”‚ Join conversation room
    â”‚ socket.emit('conversation:join', {'conversationId': 'conv123'});
    â–¼
    Server adds you to room "conv123"
    â”‚
    â”‚ Mark all messages as read
    â”‚ socket.emit('conversation:mark-all-read', {'conversationId': 'conv123'});
    â–¼
    Server marks all messages as read
    â”‚
    â”‚ Setup event listeners
    â–¼
    socket.on('message:new', handleNewMessage);
    socket.on('typing:user-typing', handleTyping);
    socket.on('typing:user-stopped', handleStopTyping);
    socket.on('user:online', handleUserOnline);
    socket.on('user:offline', handleUserOffline);
    socket.on('notification:new-message', handleNotification);


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CHAT SCREEN DISPLAYS:                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â† Back    Support Agent          [ğŸ”´ Offline]      â”‚  â”‚
â”‚  â”‚            Last seen 2 hours ago                     â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  [Support] Hello! How can I help you?               â”‚  â”‚
â”‚  â”‚            08:00 AM                             âœ“âœ“  â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  [Me] I need help with my wheat crop               â”‚  â”‚
â”‚  â”‚       09:15 AM                                  âœ“âœ“  â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  [Support] Sure! Send me a photo.                   â”‚  â”‚
â”‚  â”‚            09:20 AM                             âœ“âœ“  â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Type your message...              [ğŸ“]   [Send ğŸ“¤]  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

***

## ğŸ“¨ FLOW 2: Farmer Sends Text Message

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: FARMER TYPES AND SENDS MESSAGE                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Farmer Types in TextField
    â”‚
    â”‚ onChanged: (text) { ... }
    â–¼
    socket.emit('typing:start', {
      'conversationId': 'conv123'
    });
    â”‚
    â–¼
    Support sees: "Rajesh Kumar is typing..." ğŸ’¬
    â”‚
    â”‚ After 2 seconds of no typing
    â–¼
    socket.emit('typing:stop', {
      'conversationId': 'conv123'
    });


Farmer Taps Send Button ğŸ“¤
    â”‚
    â”‚ Validate: text.trim().isNotEmpty
    â–¼
    Disable send button
    Show loading on button
    â”‚
    â”‚ socket.emit('message:send', {
    â”‚   'conversationId': 'conv123',
    â”‚   'messageType': 'text',
    â”‚   'content': 'I need help with my wheat crop'
    â”‚ });
    â–¼
    Clear input field immediately
    messageController.clear();
    â”‚
    â”‚ Wait for server confirmation...
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SERVER PROCESSES:                                          â”‚
â”‚  1. Validates message                                       â”‚
â”‚  2. Saves to database â†’ message._id = "msg789"              â”‚
â”‚  3. Updates conversation lastMessage                        â”‚
â”‚  4. Broadcasts to room                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Server broadcasts: 'message:new'
                 â–¼
    socket.on('message:new', (data) {
      final message = Message.fromJson(data['message']);
      setState(() {
        messages.add(message);
      });
      scrollController.jumpTo(
        scrollController.position.maxScrollExtent
      );
    });
    â”‚
    â”‚ Re-enable send button
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCREEN UPDATES:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  [Me] I need help with my wheat crop               â”‚  â”‚
â”‚  â”‚       11:00 AM                                   âœ“  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  Message shows with checkmark (sent âœ“)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

***

## ğŸ“¸ FLOW 3: Farmer Sends Image

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: FARMER SENDS CROP PHOTO                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Farmer Taps Attach Button ğŸ“
    â”‚
    â”‚ final ImagePicker picker = ImagePicker();
    â”‚ final XFile? image = await picker.pickImage(
    â”‚   source: ImageSource.gallery
    â”‚ );
    â–¼
    Image selected: wheat_disease.jpg
    â”‚
    â”‚ Show loading: "Uploading image... ğŸ“¤"
    â–¼


PHASE 1: UPLOAD IMAGE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â”‚ var request = http.MultipartRequest(
    â”‚   'POST',
    â”‚   Uri.parse('http://localhost:5000/api/v1/chat/media')
    â”‚ );
    â”‚ request.headers['Authorization'] = 'Bearer $token';
    â”‚ request.fields['type'] = 'image';
    â”‚ request.files.add(
    â”‚   await http.MultipartFile.fromPath('media', image.path)
    â”‚ );
    â”‚ var response = await request.send();
    â–¼
    Server saves file and returns:
    {
      data: [{
        _id: "media789",
        url: "http://localhost:5000/uploads/chat/wheat_disease-1234.jpg",
        name: "wheat_disease.jpg"
      }]
    }
    â”‚
    â”‚ Hide loading
    â”‚ Get mediaId = "media789"
    â–¼


PHASE 2: SEND MESSAGE WITH MEDIA ID
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â”‚ socket.emit('message:send', {
    â”‚   'conversationId': 'conv123',
    â”‚   'messageType': 'image',
    â”‚   'mediaId': 'media789'
    â”‚ });
    â–¼
    Server creates message with media reference
    Server broadcasts: 'message:new' with full media URL
    â”‚
    â–¼
    socket.on('message:new', (data) {
      final message = Message.fromJson(data['message']);
      setState(() {
        messages.add(message);
      });
    });
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCREEN DISPLAYS IMAGE:                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  [Me] ğŸ–¼ï¸ wheat_disease.jpg                          â”‚  â”‚
â”‚  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚  â”‚
â”‚  â”‚       â”‚  [Image shown]      â”‚                       â”‚  â”‚
â”‚  â”‚       â”‚  Tap to view full   â”‚                       â”‚  â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚  â”‚
â”‚  â”‚       11:05 AM                                   âœ“  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  Widget: CachedNetworkImage(                               â”‚
â”‚    imageUrl: message.mediaId.url,                          â”‚
â”‚    placeholder: CircularProgressIndicator()                â”‚
â”‚  )                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

***

## ğŸ“© FLOW 4: Farmer Receives Reply

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: SUPPORT REPLIES â†’ FARMER RECEIVES                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Support Agent Types and Sends (from Next.js dashboard)
    â”‚
    â–¼
Server receives and broadcasts: 'message:new'
    â”‚
    â–¼


IF FARMER IS IN CHAT (screen open):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â”‚ socket.on('message:new', (data) {
    â”‚   final message = Message.fromJson(data['message']);
    â”‚   setState(() {
    â”‚     messages.add(message);
    â”‚     isTyping = false; // Hide typing indicator if showing
    â”‚   });
    â”‚   scrollToBottom();
    â”‚   playNotificationSound();
    â”‚   
    â”‚   // Auto mark as read
    â”‚   socket.emit('conversation:mark-all-read', {
    â”‚     'conversationId': 'conv123'
    â”‚   });
    â”‚ });
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCREEN UPDATES:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  [Support] I can see the disease.                    â”‚  â”‚
â”‚  â”‚            Apply fungicide treatment...              â”‚  â”‚
â”‚  â”‚            11:12 AM                              âœ“âœ“  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  Message appears instantly with sound ğŸ””                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


IF FARMER IS NOT IN CHAT (background/different screen):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚
    â”‚ socket.on('notification:new-message', (data) async {
    â”‚   // Show local notification
    â”‚   await flutterLocalNotificationsPlugin.show(
    â”‚     0,
    â”‚     'Support Agent replied',
    â”‚     data['message']['content'],
    â”‚     NotificationDetails(
    â”‚       android: AndroidNotificationDetails(
    â”‚         'chat_channel',
    â”‚         'Chat Notifications',
    â”‚         importance: Importance.high,
    â”‚         priority: Priority.high
    â”‚       )
    â”‚     ),
    â”‚     payload: data['conversationId']
    â”‚   );
    â”‚ });
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHONE NOTIFICATION APPEARS:                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ”” Support Agent replied                            â”‚  â”‚
â”‚  â”‚  I can see the disease. Apply fungicide...           â”‚  â”‚
â”‚  â”‚  Just now                                     [View] â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  Farmer taps notification â†’ Opens chat screen               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

***

## ğŸ”„ FLOW 5: Real-Time Indicators

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ONGOING: TYPING, ONLINE/OFFLINE, READ RECEIPTS             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TYPING INDICATOR:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Support starts typing
    â†“
socket.on('typing:user-typing', (data) {
  setState(() {
    isTyping = true;
    typingUserName = data['userName'];
  });
});
    â†“
DISPLAY:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back   Support Agent   [ğŸŸ¢]        â”‚
â”‚  Support Agent is typing... ğŸ’¬         â”‚
â”‚  â—â—â— (animated dots)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Support stops typing
    â†“
socket.on('typing:user-stopped', (data) {
  setState(() {
    isTyping = false;
  });
});
    â†“
Typing indicator disappears


ONLINE STATUS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Support comes online
    â†“
socket.on('user:online', (data) {
  if (data['userId'] == supportId) {
    setState(() {
      isSupportOnline = true;
    });
  }
});
    â†“
DISPLAY:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back   Support Agent   [ğŸŸ¢ Online]  â”‚
â”‚           Active now                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Support goes offline
    â†“
socket.on('user:offline', (data) {
  if (data['userId'] == supportId) {
    setState(() {
      isSupportOnline = false;
      lastSeen = DateTime.parse(data['lastSeen']);
    });
  }
});
    â†“
DISPLAY:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back   Support Agent   [ğŸ”´ Offline] â”‚
â”‚           Last seen 5 mins ago         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


READ RECEIPTS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Support reads your messages
    â†“
socket.on('conversation:all-read', (data) {
  setState(() {
    for (var msg in messages) {
      if (msg.senderId == myUserId) {
        msg.isRead = true;
        msg.readAt = DateTime.parse(data['readAt']);
      }
    }
  });
});
    â†“
DISPLAY: Your messages show âœ“âœ“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     I need help with wheat   [Me]      â”‚
â”‚     11:00 AM                      âœ“âœ“   â”‚
â”‚                                        â”‚
â”‚     [ğŸ–¼ï¸ wheat_disease.jpg]      [Me]   â”‚
â”‚     11:05 AM                      âœ“âœ“   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

***

## ğŸšª FLOW 6: Farmer Closes Chat

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 6: CLEANUP                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Farmer taps Back button â†
    â”‚
    â–¼
@override
void dispose() {
  // Leave conversation room
  socket.emit('conversation:leave', {
    'conversationId': conversationId
  });
  
  // Clean up
  messageController.dispose();
  scrollController.dispose();
  
  super.dispose();
}
    â”‚
    â–¼
Server removes you from room "conv123"
You stop receiving 'message:new' for this conversation
    â”‚
    â–¼
Navigate to previous screen


Farmer closes app completely
    â”‚
    â–¼
Socket disconnects automatically
    â”‚
    â–¼
Server updates:
- User.isOnline = false
- User.lastSeen = now
- Broadcasts 'user:offline' to all
    â”‚
    â–¼
Support sees: "Rajesh Kumar - Last seen just now"
```

***

## ğŸ“Š COMPLETE FARMER TIMELINE

```
TIME    FARMER ACTION                  SERVER RESPONSE
â”€â”€â”€â”€â”€   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
11:00   Opens app, taps Support        

11:01   POST /conversations â†’          Returns conversationId
        GET /messages â†’                Returns message history
        Socket connects â†’              Authenticates, sets online

11:02   emit('conversation:join') â†’    Adds to room "conv123"
        emit('mark-all-read') â†’        Marks all messages as read
        Listens for events             Setup complete

11:05   Types message
        emit('typing:start') â†’         Broadcasts to support

11:06   Sends: "I need help" â†’
        emit('message:send')           Saves to database
        Clears input                   Broadcasts 'message:new'
        â† Receives 'message:new'       Message confirmed
        Shows with âœ“

11:10   Selects crop photo
        POST /media â†’                  Saves file, returns mediaId
        Gets mediaId â†
        emit('message:send' + id) â†’    Saves message with media
        Waits...                       Broadcasts 'message:new'
        â† Receives 'message:new'       With full media URL
        Shows image âœ“

11:15   â† Receives 'message:new'       Support replied
        Shows message ğŸ’¬
        Plays sound ğŸ””
        Auto mark as read â†’            Updates database
        emit('mark-all-read')

11:20   Taps back â†
        emit('conversation:leave')     Removes from room
        dispose()

11:25   Closes app
        Socket disconnects             Sets offline, broadcasts
```

***

## âœ… FLUTTER IMPLEMENTATION CHECKLIST

### Required Packages:
```yaml
dependencies:
  socket_io_client: ^2.0.3+1
  http: ^1.1.0
  image_picker: ^1.0.4
  flutter_local_notifications: ^16.1.0
  cached_network_image: ^3.3.0
  shared_preferences: ^2.2.2
```

### HTTP APIs (4):
```dart
âœ… POST /chat/conversations          - Create/get conversation
âœ… GET /chat/conversations            - List conversations
âœ… GET /chat/messages/:conversationId - Load message history
âœ… POST /chat/media                   - Upload images/videos/audio
```

### Socket Events to EMIT (6):
```dart
âœ… socket.emit('conversation:join', {...})
âœ… socket.emit('conversation:leave', {...})
âœ… socket.emit('conversation:mark-all-read', {...})
âœ… socket.emit('message:send', {...})
âœ… socket.emit('typing:start', {...})
âœ… socket.emit('typing:stop', {...})
```

### Socket Events to LISTEN (7):
```dart
âœ… socket.on('message:new', ...)              - Receive new message
âœ… socket.on('notification:new-message', ...) - Background notification
âœ… socket.on('typing:user-typing', ...)       - Show typing indicator
âœ… socket.on('typing:user-stopped', ...)      - Hide typing indicator
âœ… socket.on('conversation:all-read', ...)    - All messages read
âœ… socket.on('user:online', ...)              - Support online
âœ… socket.on('user:offline', ...)             - Support offline
```

***

This is the **complete Farmer flow** for Flutter! Clean, focused, and ready to implement. ğŸš€ğŸ‘¨â€ğŸŒ¾